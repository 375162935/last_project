<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>修改用户信息 -- 前端</title>
    <link rel="stylesheet" href="/css/app.css">
    <link rel="stylesheet" href="/ordinary/dependencies/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/ordinary/dependencies/meanmenu/css/meanmenu.min.css">
    <link rel="stylesheet" href="/ordinary/dependencies/animate.css/css/animate.min.css">
    <link rel="stylesheet" href="/ordinary/dependencies/magnific-popup/css/magnific-popup.css">
    <link rel="stylesheet" href="/ordinary/dependencies/jquery-animated-headlines/css/jquery.animatedheadline.css">
    <link rel="stylesheet" href="/ordinary/dependencies/owl.carousel/css/owl.theme.default.min.css">
    <link rel="stylesheet" href="/ordinary/dependencies/owl.carousel/css/owl.carousel.min.css">
    <link rel="stylesheet" href="/ordinary/dependencies/flaticon/flaticon.css">

    <!--    <link href="/css/bootstrap.min.css" rel="stylesheet"-->
    <!--          th:href="@{/css/bootstrap.min.css}">-->
    <link href="/css/style.css" rel="stylesheet"
          th:href="@{/css/style.css}">
    <link rel="stylesheet" href="/ordinary/dependencies/fontawesome/css/all.min.css">

    <style>

        #dropdown a:hover {
            background-color: #eee;
        }

    </style>
</head>

<body class="sticky-header">
<!--[if lte IE 9]>
<p class="browserupgrade">您使用的浏览器已<strong>过时</strong>。请
    <a href="https://browsehappy.com/">升级您的浏览器</a>以改善体验和安全性</p>
<![endif]-->
<!-- ScrollUp Start Here -->
<a href="#wrapper" data-type="section-switch" class="scrollup">
    <i class="fas fa-angle-double-up"></i>
</a>
<!-- ScrollUp End Here -->
<!-- Preloader Start Here -->
<div id="preloader"></div>
<!-- Preloader End Here -->
<div id="wrapper" class="wrapper">
    <!--=====================================-->
    <!--=            Header Start           =-->
    <!--=====================================-->
    <div th:replace="front/common/front_header :: .front_header"></div>
    <!--=====================================-->
    <!--=          Search Box Start         =-->
    <!--=====================================-->
    <section class="inner-page-banner" data-bg-image="/ordinary/media/banner/banner1.jpg">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="breadcrumbs-area">
                        <h1>个人信息</h1>
                        <ul>
                            <li>
                                <a href="/user/toUpdUserDetail">个人信息</a>
                            </li>
                            <li>修改个人信息</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--=====================================-->
    <!--=        Account Page Start      	=-->
    <!--=====================================-->
    <section class="section-padding-equal-70">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 sidebar-break-sm sidebar-widget-area mt-0">
                    <div class="widget-bottom-margin widget-account-menu widget-light-bg">
                        <div th:replace="front/common/front_aside :: .front_aside"></div>
                    </div>
                </div>
                <div class="col-lg-9" th:if="${session.user!=null}">
                    <div class="tab-content">
                        <div id="accout-detail" role="tabpanel">
                            <div class="light-shadow-bg post-ad-box-layout1 myaccount-store-settings myaccount-detail">
                                <div class="light-box-content">
                                    <form method="post" action="#" class="site-form">
                                        <div class="form-group">
                                            <label for="username">用户名</label>
                                            <input type="text" class="form-control" name="username" id="username"
                                                   th:value="${session.user.username}" disabled="disabled"/>
                                        </div>
                                        <div class="form-group detail_name">
                                            <label for="name" id="name_text">姓名</label>
                                            <input type="text" class="form-control" name="name" id="name"
                                                   placeholder="输入您的姓名"
                                                   th:value="${session.user.name}">
                                        </div>
                                        <div class="form-group">
                                            <label for="user_type">身份</label>
                                            <input type="text" class="form-control" name="user_type" id="user_type"
                                                   th:value="${session.user.userType=='1'}?'会员顾客':(${session.user.userType=='2'}?'商家':'供应商')"
                                                   disabled="disabled">
                                        </div>
                                        <div class="form-group gender_form has-success">
                                            <label for="gender">性别</label>
                                            <div class="gender_form_div">
                                                <select class="form-control" id="gender" name="gender" size="1">
                                                    <option value="0" th:selected="${session.user.gender eq '0'}">女
                                                    </option>
                                                    <option value="1" th:selected="${session.user.gender eq '1'}">男
                                                    </option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group has-success">
                                            <label for="birthday">生日</label>
                                            <input class="form-control js-datepicker m-b-10" type="date" id="birthday"
                                                   name="birthday"
                                                   placeholder="yyyy-mm-dd"
                                                   th:value="${#dates.format(session.user.birthday,'yyyy-MM-dd')}"
                                                   data-date-format="yyyy-mm-dd"/>
                                        </div>
                                        <div class="form-group detail_phone">
                                            <label for="userPhone" id="phone_text">联系方式</label>
                                            <input type="text" class="form-control" name="userPhone" id="userPhone"
                                                   th:value="${session.user.userPhone}">
                                        </div>
                                        <div class="form-group" th:if="${session.user.userType=='1'}">
                                            <label for="integral">当前剩余会员积分</label>
                                            <input type="text" class="form-control" name="integral" id="integral"
                                                   th:value="${session.user.integral}" disabled="disabled">
                                        </div>
                                        <button type="button" class="btn btn-primary btn_update">保存</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
</body>
<script src="/ordinary/dependencies/jquery/js/jquery.min.js"></script>
<script src="/ordinary/dependencies/popper.js/js/popper.min.js"></script>
<script src="/ordinary/dependencies/bootstrap/js/bootstrap.min.js"></script>
<script src="/ordinary/dependencies/waypoints/js/jquery.waypoints.min.js"></script>
<script src="/ordinary/dependencies/jquery.counterup/js/jquery.counterup.min.js"></script>
<script src="/ordinary/dependencies/owl.carousel/js/owl.carousel.min.js"></script>
<script src="/ordinary/dependencies/imagesloaded/js/imagesloaded.pkgd.min.js"></script>
<script src="/ordinary/dependencies/isotope-layout/js/isotope.pkgd.min.js"></script>
<script src="/ordinary/dependencies/jquery-animated-headlines/js/jquery.animatedheadline.min.js"></script>
<script src="/ordinary/dependencies/magnific-popup/js/jquery.magnific-popup.min.js"></script>
<script src="/ordinary/dependencies/elevatezoom/js/jquery.elevateZoom-2.2.3.min.js"></script>
<script src="/ordinary/dependencies/bootstrap-validator/js/validator.min.js"></script>
<script src="/ordinary/dependencies/meanmenu/js/jquery.meanmenu.min.js"></script>
<script src="/ordinary/assets/js/app.js"></script>
<script src="https://ditu.google.cn/maps/api/js?key=AIzaSyBtmXSwv4YmAKtcZyyad9W7D4AC08z0Rb4"></script>
<script>
    $(function () {
        $(".active").removeClass("active");
        $(".front_update").addClass("active");

        var name_value = $("input[name=name]").val();
        var gender_value = $("select[name=gender]").val();
        var birthday_value = $("input[name=birthday]").val();
        var userPhone_value = $("input[name=userPhone]").val();
        var name = $("input[name=name]");
        var gender = $("select[name=gender]");
        var birthday = $("input[name=birthday]");
        var userPhone = $("input[name=userPhone]");
        var name_flag = true;
        var userPhone_flag = true;
        name.blur(function () {
            $("#name_i").remove();
            if (name.val() == "") {
                $("#name_text").after("<i id='name_i' style='color: red'>-----姓名不能为空-----<i/>");
                $(".detail_name").removeClass("has-success").addClass("has-warning");
                name_flag = false;
            } else {
                $(".detail_name").removeClass("has-warning").addClass("has-success");
                name_flag = true;
            }
        })
        userPhone.blur(function () {
            $("#phone_i").remove();
            if (userPhone.val() == "") {
                $("#phone_text").after("<i id='phone_i' style='color: red'>-----电话不能为空-----<i/>");
                $(".detail_phone").removeClass("has-success").addClass("has-warning");
                userPhone_flag = false;
            } else {
                $(".detail_phone").removeClass("has-warning").addClass("has-success");
                userPhone_flag = true;
            }
        })
        $(".btn_update").click(function () {
            console.log(name_value)
            console.log(gender_value)
            console.log(birthday_value)
            console.log(userPhone_value)
            if (name_value == name.val() && gender_value == gender.val() &&
                birthday_value == birthday.val() && userPhone_value == userPhone.val()) {
                alert("并未修改")
            } else if (userPhone_flag && name_flag) {
                $.ajax({
                    url: "/user/updUserDetail",
                    type: "post",
                    dataType: "json",
                    data: {
                        name: name.val(),
                        gender: gender.val(),
                        birthday: birthday.val(),
                        userPhone: userPhone.val()
                    }, success: function (data) {
                        if (data.result == "0") {
                            alert("修改失败")
                        } else {
                            window.location.href = "/user/toIndex"
                        }
                    }
                })
            } else {
                alert("请先完善信息")
            }
        })
    })
</script>
</html>